plugins {
    id 'java'
}

group 'eu.tsystems.mms.tic.testerra.skeletons'
version '2-SNAPSHOT'
ext {
    testerraVersion = '2-SNAPSHOT'
}

allprojects {

    repositories {
        mavenLocal()
    }

    compileJava.options.encoding = 'UTF-8'
    compileTestJava.options.encoding = "UTF-8"

    sourceCompatibility = 11

    dependencies {
        implementation group: 'eu.tsystems.mms.tic.testerra', name: 'core', version: testerraVersion
    }
}

test {
    // define as
    //      key: profile name
    //      value: testng suite xml filename
    def profiles = [
            "all": "AllTests.xml"
    ]

    /*
    create suite def
     */
    def suiteFiles = []
    profiles.each { k, v ->
        if (project.hasProperty("" + k)) {
            def f = 'src/test/suites/resources/' + v
            suiteFiles << f
        }
    }

    print suiteFiles

    useTestNG() {
        suites(suiteFiles as String[])
    }

    testLogging {
        outputs.upToDateWhen { false }
        showStandardStreams = true
    }

    options {
        systemProperties(System.getProperties())
    }

    // basically execution returns "GREEN" (framework exits with exit code > 0 if there were failures)
    ignoreFailures = true
}
